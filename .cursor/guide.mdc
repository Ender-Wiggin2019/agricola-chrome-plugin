---
alwaysApply: true
---

我希望你可以结合当前目录中的几个文件进行处理。由于文件都非常大，你不应该直接读取完整文件，可以选择查看前面几行。


你需要执行如下步骤：

1. 首先no和enName从`Agricola Database - Database.csv`和`Agricola Database - Database (in progress).csv`获取。
列名字如下，你需要把`Deck`和`Number`拼接成一个no(注意，Number需要先补全到3位，如1 -> 001)。然后合并这两个文件，生成一个`pk.json`文件，包含no和enName(从Name获取),effect(从Text获取)。
移除所有Deck不属于ABCDE或者Deck为空的行。

`Edition,Publisher,Base/Expansion,Deck,Number,Type,Player(s),Name,Cost,VPs,Prerequisites,Passing Left,Card Category (Revised only),Text`

1. 然后尝试匹配中文内容，用no匹配。

`cards.json` 结构形如：

```
  {
  {
    "name": "吹牛大王",
    "tier": "T0",
    "no": "A133",
    "desc": "xxx"
  }
```

匹配后，name对应cnName,tier对应baituTier，desc对应baituDesc。

3. 匹配 e.csv。

这个文件只有 `no,name`，匹配为 cnName。

4. 匹配英文。

使用en.json，结构类似：

```
    {
      "base_expansion": "Base",
      "card_title": "Academic",
      "category": "",
      "cost": "",
      "improvement_complement": "Improvements that trigger additional benefits when multiple Occupations are played, or improvements that reward high numbers of Occupations.",
      "insight": "xxx",
      "players": "3+",
      "rating": 2,
      "text": "This card counts as 2 Occupations for Minor Improvements and when scoring the \"Reeve\" Occupation card.",
      "type": "Occupation",
      "vps": ""
    },
```
英文基于card_title匹配enName，insight匹配enDesc，rating匹配enTier。注意，rating匹配规则如下：12345对应EDCBA，0的话设为空。

5. **生成一个索引的csv `index_raw.csv`，包含 no,cnName,enName,baituTier,enTier,chenTier,effect,baituDesc,enDesc,chenDesc 这些列。**
6. 然后，对于baituTier,enTier,chenTier,baituDesc,enDesc,chenDesc这些全都为空的情况，移除这一行，生成`index.csv`

7. 把set_o.json里面的name，和cnName匹配一下。tier作为chenTier，desc作为chenTier。匹配不上的忽略

```
    {
        "time": "0:1:37",
        "name": "绩效导师",
        "tier": "A",
        "desc": "弱A，理论收益虽然很高，但这张卡并不能够使你打出很多的攻防，非常依赖于其他的卡能给你提供配合，单卡强度其实还算有限"
    },
```

8. 我有两个文件在scripts/4p_de.tsv和4p_nb.tsv。
你可以查卡一下这两个文件的前几行了解数据结构，但不要一次性完全读取。
你需要处理这两个文件，

我希望你做的是：
解析这两个文件，然后获取其中的统计数据(pwr,adp, drawPlayRate(use plays / drafted))。然后按照 Card Name 作为索引，和enName匹配。4p_de的字段加上de前缀，nb加上nb前缀。
```
Rank Card Name	PWR	ADP	APR	Deals	Drafted	Plays	W-Hand	W-Play	WtdPWR	Elo/Play
```

实现一个数据处理脚本，可以把这些数据整理合并，


9.最终基于`index.csv`生成一个`card_all.json`，把csv转成json。
注意，对于统计数据，我希望你能生成的是这样一个字段：

```
{
  "stats": {
    "default": {
      "pwr": xxx,
      "adp": xxx,
      "apr": xxx,
      "drawPlayRate": xxx,
    },
    "nb": {
      // ... same
    }
  }
}

```

9. 基于 index.csv，生成一个 index_missing.csv，包含所有cnName为空的行。